<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etiqueta</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/animations.css">
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen in-circle-bottom-left">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full m-4">
        <h1 class="text-2xl font-bold mb-4">Etiqueta Detalles</h1>
        <div class="mb-4 md:grid md:grid-cols-2 gap-2 border-b-2"> 
            <img src="/static/img/logo.png" alt="Logo de etiquetas" class="h-20 w-20">
            <p class="text-gray-700 font-semibold">{{ item.empresa }}</p>
        </div>
        <div class="mb-4 mt-4">
            <p class="text-gray-700 font-semibold">No Serie:</p>
            <p class="text-gray-900">{{ item.noSerie }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">Fecha:</p>
            <p class="text-gray-900">{{ item.fecha }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">SAP:</p>
            <p class="text-gray-900">{{ item.sap }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">PREV:</p>
            <p class="text-gray-900">{{ item.prev }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">AMP:</p>
            <p class="text-gray-900">{{ item.amp }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">RPM:</p>
            <p class="text-gray-900">{{ item.rpm }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">Capacidad:</p>
            <p class="text-gray-900">{{ item.capacidad }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">CORR:</p>
            <p class="text-gray-900">{{ item.corr }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">voltaje:</p>
            <p class="text-gray-900">{{ item.voltaje }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">Frame:</p>
            <p class="text-gray-900">{{ item.frame }}</p>
        </div>
        <div class="mt-2 mb-4">
            <p class="text-gray-700 font-semibold">TELS:</p>
            <p class="text-gray-900">{{ item.tels }}</p>
        </div>
        <div class="mb-4">
            <p class="text-gray-700 font-semibold">Dirección:</p>
            <p class="text-gray-900">{{ item.direccion }}</p>
        </div>
        <div class="mb-4 border-b-2">
            <p class="text-gray-700 font-semibold">Descripción:</p>
            <p class="text-gray-900">{{ item.descripcion }}</p> 
        </div>

        <aside class="md:grid md:grid-cols-1">
        
            <div class="mb-4">
                <a href="/update/{{ item.noSerie}}" class="bg-blue-500 text-white p-2 w-full rounded "> <i class='bx bx-message-square-edit' ></i> MODIFICAR </a>
            </div>

            <div class="container mx-auto py-8">
                <div id="history-container" class="bg-white p-4 rounded shadow-md">
                    <button id="history-button" class="bg-green-500 text-white p-2 rounded">Imprimir Historial</button>
                    <textarea id="history-textarea" class="mt-2 p-2 w-full h-40 bg-white border rounded hidden"></textarea>
                </div>
            </div>

        </aside>
        
    </div>

    <script>
        $(document).ready(function() {
            // Obtener el número de serie desde el HTML renderizado
            var noSerie = "{{ item.noSerie }}";  // Asegúrate de que `item.noSerie` esté correctamente renderizado
    
            // Alternativa: Si deseas obtener el número de serie desde la URL
            // var noSerie = window.location.pathname.split('/').pop(); // Toma el último segmento de la URL
    
            $('#history-button').on('click', function() {
                var historyTextarea = $('#history-textarea');
                
                if (historyTextarea.hasClass('hidden')) {
                    historyTextarea.val(''); // Limpiar contenido previo
                    
                    // Llamada a la API con el número de serie
                    $.getJSON('/historico/' + noSerie, function(records) {
                        // Ordenar registros por fecha
                        records.sort(function(a, b) {
                            return new Date(b.fecha) - new Date(a.fecha);
                        });
    
                        // Recorrer los registros y agregarlos al textarea
                        $.each(records, function(index, record) {
                            var recordContent = 
                                'Fecha: ' + record.fecha + '\n' +
                                'Descripción: ' + record.descripcion + '\n\n';
                            historyTextarea.val(historyTextarea.val() + recordContent);
                        });
    
                        // Mostrar el textarea con el historial
                        historyTextarea.removeClass('hidden');
                    });
                } else {
                    // Ocultar el textarea si ya está visible
                    historyTextarea.addClass('hidden');
                }
            });
        });
    </script>
    
</body>
</html>
